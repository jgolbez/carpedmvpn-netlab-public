# OSPF Network Types Lab

## Objective
Learn how OSPF behaves on different network types (broadcast, point-to-point, point-to-multipoint) by configuring and observing DR/BDR election and LSA generation.

## Topology
```
        R1 (Hub)
       / | \
     R2  R3  R4
   
R1:
  lo: 1.1.1.1/32
  eth1: 10.0.12.1/30 (to R2)
  eth2: 10.0.13.1/30 (to R3)
  eth3: 10.0.14.1/30 (to R4)

R2: 2.2.2.2/32, eth1: 10.0.12.2/30
R3: 3.3.3.3/32, eth1: 10.0.13.2/30
R4: 4.4.4.4/32, eth1: 10.0.14.2/30
```

## Pre-configured Setup

This lab comes with:
- IP addresses configured on all interfaces
- FRR daemons running
- **No OSPF configured** - you'll configure this yourself

## Starting the Lab

1. Deploy the lab:
   ```bash
   containerlab deploy -t topology.yml
   # Or with sudo if needed:
   sudo containerlab deploy -t topology.yml
   ```

2. Access the routers:
   ```bash
   docker exec -it clab-ospf-lab2-network-types-r1 vtysh
   docker exec -it clab-ospf-lab2-network-types-r2 vtysh
   docker exec -it clab-ospf-lab2-network-types-r3 vtysh
   docker exec -it clab-ospf-lab2-network-types-r4 vtysh
   ```

## Lab Tasks

### Task 1: Configure OSPF with Broadcast Network Type

#### On R1:
```
configure terminal
router ospf
 ospf router-id 1.1.1.1
 network 1.1.1.1/32 area 0
 network 10.0.12.0/30 area 0
 network 10.0.13.0/30 area 0
exit
interface eth1
 ip ospf network broadcast
exit
interface eth2
 ip ospf network broadcast
exit
exit
write memory
```

#### On R2:
```
configure terminal
router ospf
 ospf router-id 2.2.2.2
 network 2.2.2.2/32 area 0
 network 10.0.12.0/30 area 0
exit
interface eth1
 ip ospf network broadcast
exit
exit
write memory
```

#### On R3 (similar pattern):
```
configure terminal
router ospf
 ospf router-id 3.3.3.3
 network 3.3.3.3/32 area 0
 network 10.0.13.0/30 area 0
exit
interface eth1
 ip ospf network broadcast
exit
exit
write memory
```

Wait 10 seconds, then verify:
```
show ip ospf neighbor
```

You should see neighbors with state "Full/DR" or "Full/Backup".

### Task 2: Observe DR/BDR Election

1. **Check DR/BDR roles on R1:**
   ```
   show ip ospf interface eth1
   ```
   Look for:
   - "Network Type BROADCAST"
   - "State DR" or "State Backup"
   - "Designated Router (ID)" and IP
   - "Backup Designated Router (ID)" and IP

2. **Check the OSPF database for Type 2 LSAs:**
   ```
   show ip ospf database
   ```
   Under "Net Link States" you'll see Type 2 LSAs generated by the DR.

3. **Compare with production multi-access segments:**
   In production, you'd have all routers on the same subnet (e.g., 10.0.1.0/24) connected via a switch.
   Our lab uses separate /30 links, so each link has its own DR/BDR election.
   The commands and concepts are identical - just the topology differs.

### Task 3: Manipulate DR/BDR Election

1. **Change R1's priority to become DR:**
   ```
   configure terminal
   interface eth1
    ip ospf priority 255
   exit
   exit
   ```

2. **Force re-election (don't do this in production!):**
   ```
   clear ip ospf process
   yes
   ```

3. **Verify R1 is now DR:**
   ```
   show ip ospf neighbor
   show ip ospf interface eth1
   ```

4. **Prevent a router from becoming DR/BDR:**
   On R2, set priority to 0:
   ```
   configure terminal
   interface eth1
    ip ospf priority 0
   exit
   exit
   clear ip ospf process
   yes
   ```
   R2 will never be DR or BDR with priority 0.

### Task 4: Configure Point-to-Point Network Type

1. **On R1, add R4 with point-to-point:**
   ```
   configure terminal
   router ospf
    network 10.0.14.0/30 area 0
   exit
   interface eth3
    ip ospf network point-to-point
   exit
   exit
   write memory
   ```

2. **On R4:**
   ```
   configure terminal
   router ospf
    ospf router-id 4.4.4.4
    network 4.4.4.4/32 area 0
    network 10.0.14.0/30 area 0
   exit
   interface eth1
    ip ospf network point-to-point
   exit
   exit
   write memory
   ```

3. **Verify point-to-point neighbor:**
   ```
   show ip ospf neighbor
   ```
   Look for R4 with state "Full/-" (the dash means no DR/BDR).

4. **Compare interface details:**
   ```
   show ip ospf interface eth3
   ```
   You'll see:
   - "Network Type POINTOPOINT"
   - "No designated router on this network"

5. **Check OSPF database:**
   ```
   show ip ospf database
   ```
   Notice: No Type 2 LSA for the R1-R4 link (point-to-point doesn't need it).

### Task 5: Experiment with Point-to-Multipoint

1. **Change R1-R2 link to point-to-multipoint:**
   On R1:
   ```
   configure terminal
   interface eth1
    ip ospf network point-to-multipoint
   exit
   exit
   ```
   
   On R2:
   ```
   configure terminal
   interface eth1
    ip ospf network point-to-multipoint
   exit
   exit
   ```

2. **Wait 40 seconds for neighbors to reform, then check:**
   ```
   show ip ospf neighbor
   ```
   R2 should now show state "Full/-" (no DR/BDR).

3. **Check interface timers:**
   ```
   show ip ospf interface eth1
   ```
   Notice:
   - "Network Type POINTOMULTIPOINT"
   - "Hello 30s, Dead 120s" (different from broadcast's 10s/40s)

4. **Check routing table for host routes:**
   ```
   show ip route ospf
   ```
   You'll see a /32 host route for R2's interface IP (10.0.12.2/32).
   This is unique to point-to-multipoint.

### Task 6: Compare Network Types Side-by-Side

With R1-R2 as point-to-multipoint, R1-R3 as broadcast, and R1-R4 as point-to-point:

```
show ip ospf neighbor
```

Compare the "Pri" and "State" columns:
- **Broadcast (R3):** Priority matters, state shows DR/Backup
- **Point-to-Point (R4):** Pri=0, state is "Full/-"
- **Point-to-Multipoint (R2):** Pri=0, state is "Full/-"

```
show ip ospf database
```

Compare LSAs:
- Type 2 LSAs only for broadcast links
- No Type 2 LSAs for point-to-point or point-to-multipoint

## Useful Commands Reference

| Purpose | Command |
|---------|---------|
| Show OSPF neighbors | `show ip ospf neighbor` |
| Show interface details | `show ip ospf interface eth1` |
| Show OSPF database | `show ip ospf database` |
| Show OSPF routes | `show ip route ospf` |
| Configure network type | `ip ospf network <broadcast\|point-to-point\|point-to-multipoint>` |
| Configure OSPF priority | `ip ospf priority <0-255>` |
| Clear OSPF process | `clear ip ospf process` |
| Save configuration | `write memory` |

## Network Type Decision Guide

| Scenario | Network Type | Why? |
|----------|--------------|------|
| LAN with 3+ routers on same subnet | Broadcast | Default for Ethernet, reduces flooding |
| Direct WAN link between 2 routers | Point-to-Point | No DR/BDR needed, faster convergence |
| Hub-spoke VPN or MPLS | Point-to-Multipoint | No DR/BDR overhead, works with partial mesh |
| Legacy Frame Relay | NBMA | Obsolete, use point-to-multipoint instead |

## Understanding Network Types

### Broadcast
- **Default on:** Ethernet interfaces
- **DR/BDR:** Yes (reduces flooding)
- **Hello/Dead:** 10s/40s
- **Type 2 LSA:** Yes (generated by DR)
- **Best for:** LAN segments with multiple routers

### Point-to-Point
- **Default on:** Serial interfaces
- **DR/BDR:** No (only 2 routers)
- **Hello/Dead:** 10s/40s
- **Type 2 LSA:** No
- **Best for:** WAN links, direct connections

### Point-to-Multipoint
- **Default on:** None (must configure)
- **DR/BDR:** No
- **Hello/Dead:** 30s/120s
- **Type 2 LSA:** No
- **Host routes:** Creates /32 for each neighbor
- **Best for:** Hub-spoke topologies, partial mesh

## Production Multi-Access Segments

In production networks, broadcast segments typically look like this:

```
     10.0.1.0/24 (single subnet)
            |
      [L2 Switch]
       /    |    \
     R1    R2    R3
     .1    .2    .3
```

**Key differences from our lab:**
- All routers on **same subnet** (10.0.1.0/24)
- Connected via **Layer 2 switch**
- **One DR election** for entire segment
- You'd see **DROther** state (router that's neither DR nor BDR)

**In our lab:**
- Each link has **separate subnet** (/30)
- Direct router-to-router connections
- **Separate elections** per link
- Only 2 routers per link = always one DR, one BDR (or neither)

**Important:** All the commands, concepts, and verification steps are identical.
The topology is simplified for lab portability, but the OSPF behavior is the same.

## FRR vs Cisco Command Differences

| Cisco IOS | FRR |
|-----------|-----|
| `router ospf 1` | `router ospf` |
| `network 10.0.12.0 0.0.0.3 area 0` | `network 10.0.12.0/30 area 0` |
| `ip ospf network broadcast` | `ip ospf network broadcast` (same!) |
| `ip ospf priority 100` | `ip ospf priority 100` (same!) |

## Cleanup

When finished:
```bash
containerlab destroy -t topology.yml --cleanup
# Or with sudo:
sudo containerlab destroy -t topology.yml --cleanup
```

## Challenge Questions

1. Why do broadcast networks need a DR/BDR?
2. What happens if you configure different network types on each end of a link?
3. When would you use point-to-multipoint instead of broadcast?
4. Why does point-to-multipoint have longer timers (30s/120s)?
5. How many Type 2 LSAs would a true broadcast segment with 5 routers generate?
6. What's the purpose of setting priority to 0?
7. Can you have DR/BDR election on a point-to-point link? Why or why not?

## Next Steps

- Try creating a true multi-access segment using VLANs
- Experiment with NBMA network type (legacy)
- Configure demand circuit on slow links
- Try changing hello/dead timers manually
- Combine different network types in a multi-area topology
